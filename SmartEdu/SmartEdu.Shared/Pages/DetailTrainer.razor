@page "/trainerdetail/{IdTrainer:int}"
@using System.Net.Http.Json
@using SmartEdu.Shared.Models
@inject NavigationManager Nav
@inject HttpClient Http
@using SmartEdu.Shared.Services
@inject ITextToSpeechService TextToSpeech

<div class="hero-section">
    <h1 class="system-title">SmartEdu</h1>
    <p class="system-subtitle">Hybrid Learning Management System for Modern Education</p>
</div>
<h2 class="trainer-detail-title">Trainer Detail</h2>

@if (Trainer == null)
{
    <p class="loading-text">Loading trainer details...</p>
}
else
{
    <div class="trainer-detail-container">
        <div class="trainer-card-detail">
            <div class="trainer-avatar-detail">👨‍🏫</div>
            <div class="trainer-info-detail">

                <div style="display: flex; align-items: center; gap: 10px;">
                    <h3 style="margin:0;">@Trainer.Name</h3>
                    <button @onclick="ReadDescription" class="btn-sound" title="Baca Deskripsi">
                        🔊
                    </button>
                </div>
                <p><strong>ID:</strong> @Trainer.IdTrainer</p>
                <p>
                    <strong>Email:</strong>
                    <a href="mailto:@Trainer.Email" style="text-decoration: none; color: #007bff; font-weight: bold;">
                        @Trainer.Email
                    </a>
                </p>                <p>
                    <strong>Phone:</strong>
                    <a href="tel:@Trainer.Phone" style="text-decoration: none; color: #007bff; font-weight: bold;">
                        @Trainer.Phone
                    </a>
                </p>                
                <p><strong>Address:</strong> @Trainer.Address</p>
            </div>
        </div>

        <div class="trainer-courses-section">
            <h3>Courses Taught</h3>

            @if (Trainer.Courses == null || !Trainer.Courses.Any())
            {
                <p class="no-courses">This trainer has no assigned courses.</p>
            }
            else
            {
                <ul class="course-list">
                    @foreach (var course in Trainer.Courses)
                    {
                        <li class="course-item">
                            <div class="course-icon">📘</div>
                            <div class="course-info">
                                <h4>@course.Title</h4>
                                <p>@course.Description</p>
                                <span class="duration">@course.DurationInHours Hours</span>
                            </div>
                        </li>
                    }
                </ul>
            }
        </div>

        <button class="back-btn" @onclick="GoBack">← Back</button>
    </div>
}

@code {
    [Parameter] public int IdTrainer { get; set; }
    private Trainer? Trainer;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            Trainer = await Http.GetFromJsonAsync<Trainer>($"https://localhost:7194/api/trainers/{IdTrainer}");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error fetching trainer details: {ex.Message}");
        }
    }

    private async Task ReadDescription()
    {
        if (Trainer != null)
        {
            // Teks yang akan dibaca: Nama + Alamat (atau deskripsi lain jika ada)
            string textToRead = $"Trainer name is {Trainer.Name}. Contact number {Trainer.Phone}. Address at {Trainer.Address}.";

            await TextToSpeech.SpeakAsync(textToRead);
        }
    }

    public void Dispose()
    {
        TextToSpeech.CancelAsync();
    }

    private void GoBack()
    {
        Nav.NavigateTo("/trainers");
    }
}